
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../data.md/">
      
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>Holy Core - Dev Docs - Holy Core - Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.618322db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../styles/custom.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#holy-core-dev-docs" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Holy Core - Documentation" class="md-header__button md-logo" aria-label="Holy Core - Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Holy Core - Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Holy Core - Dev Docs
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Holy Core - Documentation" class="md-nav__button md-logo" aria-label="Holy Core - Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Holy Core - Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Holy Core - User Docs
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../data.md/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Holy Core - Data Sheet
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Holy Core - Dev Docs
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Holy Core - Dev Docs
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#rtl-contributions-guidelines" class="md-nav__link">
    <span class="md-ellipsis">
      
        RTL Contributions Guidelines
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Core Overview
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scheme" class="md-nav__link">
    <span class="md-ellipsis">
      
        Scheme
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#io-table" class="md-nav__link">
    <span class="md-ellipsis">
      
        I/O table
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modules-functionalities" class="md-nav__link">
    <span class="md-ellipsis">
      
        Modules Functionalities
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Modules Functionalities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#external-requests-arbiters" class="md-nav__link">
    <span class="md-ellipsis">
      
        External Requests Arbiters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#instruction-cache-i" class="md-nav__link">
    <span class="md-ellipsis">
      
        Instruction Cache (I$)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-cache-d" class="md-nav__link">
    <span class="md-ellipsis">
      
        Data Cache (D$)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stalling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stalling
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#control" class="md-nav__link">
    <span class="md-ellipsis">
      
        Control
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#csr-file" class="md-nav__link">
    <span class="md-ellipsis">
      
        CSR File
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CSR File">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#trap-execution-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Trap Execution Flow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#debug-execution-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Debug Execution Flow
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#register-file" class="md-nav__link">
    <span class="md-ellipsis">
      
        Register File
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sign-extender-imm-decoder" class="md-nav__link">
    <span class="md-ellipsis">
      
        Sign Extender / Imm Decoder
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#second-adder" class="md-nav__link">
    <span class="md-ellipsis">
      
        Second Adder
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alu" class="md-nav__link">
    <span class="md-ellipsis">
      
        ALU
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loadstore-decoder" class="md-nav__link">
    <span class="md-ellipsis">
      
        Load/Store Decoder
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reader" class="md-nav__link">
    <span class="md-ellipsis">
      
        Reader
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#write-back-mux" class="md-nav__link">
    <span class="md-ellipsis">
      
        Write Back Mux
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dev-workflow-simulation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Dev Workflow &amp; Simulation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Dev Workflow &amp; Simulation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#verification-software-stack" class="md-nav__link">
    <span class="md-ellipsis">
      
        Verification Software Stack
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generic-rtl-changes-testing-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Generic RTL Changes &amp; Testing Workflow
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Generic RTL Changes &amp; Testing Workflow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#navigating-and-using-the-tb-folder-for-submodules" class="md-nav__link">
    <span class="md-ellipsis">
      
        Navigating and Using the tb/ Folder for submodules
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verifying-the-holy-core-using-the-cocotb-testbench" class="md-nav__link">
    <span class="md-ellipsis">
      
        Verifying the HOLY CORE using the cocotb testbench
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Verifying the HOLY CORE using the cocotb testbench">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#testbench-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Testbench Structure
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-program" class="md-nav__link">
    <span class="md-ellipsis">
      
        Test Program
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verifying-the-core-using-riscof" class="md-nav__link">
    <span class="md-ellipsis">
      
        Verifying the core using RISCOF
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#riscof-debugging-guidelines" class="md-nav__link">
    <span class="md-ellipsis">
      
        RISCOF Debugging Guidelines
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simulating-real-program-execution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Simulating Real Program Execution
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Simulating Real Program Execution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prepare-your-program" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prepare your Program
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prepare-the-holy_topsv-soc" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prepare the holy_top.sv SoC
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#rtl-contributions-guidelines" class="md-nav__link">
    <span class="md-ellipsis">
      
        RTL Contributions Guidelines
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Core Overview
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scheme" class="md-nav__link">
    <span class="md-ellipsis">
      
        Scheme
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#io-table" class="md-nav__link">
    <span class="md-ellipsis">
      
        I/O table
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modules-functionalities" class="md-nav__link">
    <span class="md-ellipsis">
      
        Modules Functionalities
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Modules Functionalities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#external-requests-arbiters" class="md-nav__link">
    <span class="md-ellipsis">
      
        External Requests Arbiters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#instruction-cache-i" class="md-nav__link">
    <span class="md-ellipsis">
      
        Instruction Cache (I$)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-cache-d" class="md-nav__link">
    <span class="md-ellipsis">
      
        Data Cache (D$)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stalling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stalling
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#control" class="md-nav__link">
    <span class="md-ellipsis">
      
        Control
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#csr-file" class="md-nav__link">
    <span class="md-ellipsis">
      
        CSR File
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CSR File">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#trap-execution-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Trap Execution Flow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#debug-execution-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Debug Execution Flow
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#register-file" class="md-nav__link">
    <span class="md-ellipsis">
      
        Register File
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sign-extender-imm-decoder" class="md-nav__link">
    <span class="md-ellipsis">
      
        Sign Extender / Imm Decoder
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#second-adder" class="md-nav__link">
    <span class="md-ellipsis">
      
        Second Adder
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alu" class="md-nav__link">
    <span class="md-ellipsis">
      
        ALU
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loadstore-decoder" class="md-nav__link">
    <span class="md-ellipsis">
      
        Load/Store Decoder
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reader" class="md-nav__link">
    <span class="md-ellipsis">
      
        Reader
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#write-back-mux" class="md-nav__link">
    <span class="md-ellipsis">
      
        Write Back Mux
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dev-workflow-simulation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Dev Workflow &amp; Simulation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Dev Workflow &amp; Simulation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#verification-software-stack" class="md-nav__link">
    <span class="md-ellipsis">
      
        Verification Software Stack
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generic-rtl-changes-testing-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Generic RTL Changes &amp; Testing Workflow
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Generic RTL Changes &amp; Testing Workflow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#navigating-and-using-the-tb-folder-for-submodules" class="md-nav__link">
    <span class="md-ellipsis">
      
        Navigating and Using the tb/ Folder for submodules
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verifying-the-holy-core-using-the-cocotb-testbench" class="md-nav__link">
    <span class="md-ellipsis">
      
        Verifying the HOLY CORE using the cocotb testbench
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Verifying the HOLY CORE using the cocotb testbench">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#testbench-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Testbench Structure
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-program" class="md-nav__link">
    <span class="md-ellipsis">
      
        Test Program
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verifying-the-core-using-riscof" class="md-nav__link">
    <span class="md-ellipsis">
      
        Verifying the core using RISCOF
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#riscof-debugging-guidelines" class="md-nav__link">
    <span class="md-ellipsis">
      
        RISCOF Debugging Guidelines
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simulating-real-program-execution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Simulating Real Program Execution
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Simulating Real Program Execution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prepare-your-program" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prepare your Program
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prepare-the-holy_topsv-soc" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prepare the holy_top.sv SoC
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="holy-core-dev-docs">Holy Core - Dev Docs</h1>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>As you may already know, most of the CPU architecture is documented through the <strong>tutorials</strong> around which the HOLY CORE Course project is built around.</p>
<p>But this document aims at giving an overview of the <strong>latest changes</strong> by going <strong>straight to the point</strong> as briefly as possible to clear potential doubts on what's the potential role of each part of the CPU.</p>
</div>
<p>Welcome to the Dev's documentation, a quick reference guide on how the core works to quickly get up to speed.</p>
<p>You'll see the core is <strong>extremely simple</strong> as it's a :</p>
<ul>
<li>no frontend...</li>
<li>...no scoreboard...</li>
<li>...single fetch...</li>
<li>...single execution at a time...</li>
<li>...single cycle CPU.</li>
</ul>
<p>You'll also find here some guidelines and simulation tips, as well as some notes for myself.</p>
<h2 id="rtl-contributions-guidelines">RTL Contributions Guidelines</h2>
<p>If you want to modify the HDL and contribute, please know that I am <strong>not interested in major architecture modifications</strong> (e.g. pipelining).</p>
<p>Typos fix are <em>welcome changes</em>.</p>
<p>Docs improvements, code optimisations or more efficient synth code structure that could save LUTs and FFs are <strong>very welcome</strong> <strong>changes</strong>.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You can check out the <code>todo.md</code> file at the root of the project to see what are the projects things that should be done if you are looking for quick ways to participate.</p>
</div>
<p>When making an RTL change to a module, make sure you run the module's testbench, eventually add testcases to the said testbench, run the HOLY CORE quick testbench and then run the riscof test suite.</p>
<p>This document will also guide you around all the simulation and verification tools available.</p>
<h2 id="core-overview">Core Overview</h2>
<h3 id="scheme">Scheme</h3>
<p><img alt="main core scheme" src="../images/main_scheme.png" /></p>
<p>As you can see, the HOLY CORE is simple. In fact, most of the important signals are on this scheme, though some subtle execution flows like <strong>traps</strong> or <strong>debug request</strong> are not made obvious here.</p>
<h3 id="io-table">I/O table</h3>
<table>
<thead>
<tr>
<th>Signal</th>
<th>Direction</th>
<th>Width</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>clk</code></td>
<td>Input</td>
<td>1</td>
<td>System clock</td>
</tr>
<tr>
<td><code>rst_n</code></td>
<td>Input</td>
<td>1</td>
<td>Active-low asynchronous reset</td>
</tr>
<tr>
<td><code>debug_req</code></td>
<td>Input</td>
<td>1</td>
<td>Debug request signal from debugger</td>
</tr>
<tr>
<td><code>debug_halt_addr</code></td>
<td>Input</td>
<td>32</td>
<td>Address to jump to when entering debug mode (debug ROM base address)</td>
</tr>
<tr>
<td><code>debug_exception_addr</code></td>
<td>Input</td>
<td>32</td>
<td>Address to jump to for debug exceptions (typically debug ROM + offset)</td>
</tr>
<tr>
<td><code>timer_itr</code></td>
<td>Input</td>
<td>1</td>
<td>Machine timer interrupt (MTIP)</td>
</tr>
<tr>
<td><code>soft_itr</code></td>
<td>Input</td>
<td>1</td>
<td>Machine software interrupt (MSIP)</td>
</tr>
<tr>
<td><code>ext_itr</code></td>
<td>Input</td>
<td>1</td>
<td>Machine external interrupt (MEIP)</td>
</tr>
<tr>
<td><code>m_axi</code></td>
<td>Output</td>
<td>AXI Master</td>
<td>AXI master interface for main memory access (instructions &amp; data)</td>
</tr>
<tr>
<td><code>m_axi_lite</code></td>
<td>Output</td>
<td>AXI-Lite Master</td>
<td>AXI-Lite master interface for peripheral/CSR access</td>
</tr>
</tbody>
</table>
<h2 id="modules-functionalities">Modules Functionalities</h2>
<p>This part aims at briefly presenting the modules, what they do and their specificities.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Modules' code can be found in the <code>hdl/</code> folder.</p>
</div>
<h3 id="external-requests-arbiters">External Requests Arbiters</h3>
<p>It's not explicitly detailed in the scheme, but there are two arbiters :</p>
<ul>
<li><code>LITE ARBITRER</code></li>
<li><code>FULL ARBITRER</code></li>
</ul>
<p>Because the HOLY CORE has CSRs to setup cached memory ranges (<a href="/#external-interfaces-cache-usage-for-the-user-via-csrs">see user guide</a>), we have to have 2 interface per cache (I$ and D$) : an AXI one to retrieve cache data and an AXI LITE one to interact with non cachable ranges.</p>
<p>This means the holy core has 2 of each ! What the arbitrer do is <strong>keep track of what cache is using the interface</strong> (through the <code>serving</code> signal) and <strong>routes that request to the outside world</strong> until it's finished.</p>
<h3 id="instruction-cache-i">Instruction Cache (I$)</h3>
<p>The instruction cache is also not detailed in the scheme but it's actually 2 separate module :</p>
<ul>
<li>Instruction Cache</li>
<li>Instruction No cache</li>
</ul>
<p>This is because the HOLY CORE has CSRs to setup cached memory ranges (<a href="/#external-interfaces-cache-usage-for-the-user-via-csrs">see user guide</a>).</p>
<p>The Instruction cache can <strong>only issue read requests</strong>.</p>
<p>The core's data path determines if the requested PC is cachable or not and route the request to the right cache submodule ($ or NO$) using a handshake interface that looks like this :</p>
<table>
<thead>
<tr>
<th>Signal Name</th>
<th>Direction</th>
<th>Width</th>
<th>Type</th>
<th>Function</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>address</code></td>
<td>Input</td>
<td>[31:0]</td>
<td>Address</td>
<td>Memory address for read/write transaction</td>
</tr>
<tr>
<td><code>read_data</code></td>
<td>Output</td>
<td>[31:0]</td>
<td>Data</td>
<td>Data returned from memory read operation</td>
</tr>
<tr>
<td><code>req_valid</code></td>
<td>Input</td>
<td>1 bit</td>
<td>Valid</td>
<td>CPU asserts to indicate valid address and request</td>
</tr>
<tr>
<td><code>req_ready</code></td>
<td>Output</td>
<td>1 bit</td>
<td>Ready</td>
<td>Interface asserts to indicate ready to accept request</td>
</tr>
<tr>
<td><code>read_valid</code></td>
<td>Output</td>
<td>1 bit</td>
<td>Valid</td>
<td>Interface asserts when read_data is valid and available</td>
</tr>
<tr>
<td><code>read_ack</code></td>
<td>Input</td>
<td>1 bit</td>
<td>Handshake</td>
<td>CPU asserts to acknowledge/accept read_data</td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Having a handshake interface with the CPU helps creating a more robust interface, which is essential when dealing with cache that pretty much go on with their life most of the time retrieving and sending data around.</p>
</div>
<h3 id="data-cache-d">Data Cache (D$)</h3>
<p>The data cache is like the instruction cache, but the CPU also has a "write" handshake interface.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Writes are non blocking and are accepted right away if the cache is idling, even if the cache misses.</p>
</div>
<p>Just like the data cache, there are 2 submodules :</p>
<ul>
<li>Instruction Cache</li>
<li>Instruction No cache</li>
</ul>
<p>This is because the HOLY CORE has CSRs to setup cached memory ranges (<a href="/#external-interfaces-cache-usage-for-the-user-via-csrs">see user guide</a>).</p>
<p>The core's data path determines if the requested data address is cachable or not and route the request to the right cache submodule ($ or NO$) using a handshake interface that looks like this :</p>
<table>
<thead>
<tr>
<th>Signal Name</th>
<th>Direction</th>
<th>Width</th>
<th>Type</th>
<th>Function</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>address</code></td>
<td>Input</td>
<td>[31:0]</td>
<td>Address</td>
<td>Memory address for read/write transaction</td>
</tr>
<tr>
<td><code>read_data</code></td>
<td>Output</td>
<td>[31:0]</td>
<td>Data</td>
<td>Data returned from memory read operation</td>
</tr>
<tr>
<td><code>req_valid</code></td>
<td>Input</td>
<td>1 bit</td>
<td>Valid</td>
<td>CPU asserts to indicate valid address and request</td>
</tr>
<tr>
<td><code>req_ready</code></td>
<td>Output</td>
<td>1 bit</td>
<td>Ready</td>
<td>Interface asserts to indicate ready to accept request</td>
</tr>
<tr>
<td><code>read_valid</code></td>
<td>Output</td>
<td>1 bit</td>
<td>Valid</td>
<td>Interface asserts when read_data is valid and available</td>
</tr>
<tr>
<td><code>read_ack</code></td>
<td>Input</td>
<td>1 bit</td>
<td>Handshake</td>
<td>CPU asserts to acknowledge/accept read_data</td>
</tr>
</tbody>
</table>
<p>The handshake delay can vary greatly depending on whether the cache missed or got a HIT.</p>
<h3 id="stalling">Stalling</h3>
<p>The main stall signal depend on <code>i_cache_stall || d_cache_stall</code>, which both depends on their respective handshake state.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>If the control signal that we read from memory (via <code>mem_read_enable</code>) but the <code>data_read_valid</code> is low (or we did not acknowledged it via <code>data_read_ack</code>, then we stall to "wait for the data request to be done", same for writing requests (with <code>mem_write_enable</code>, <code>data_req_ready</code> and <code>data_req_valid</code>)) and same for instruction read requests.</p>
</div>
<p>The stalling signal is <strong>central</strong> to this cpu, it is the only way (as there is no frontend to decide how to feed the hardware with instruction) to <strong>stop the execution flow</strong> in order to wait for something to be done. </p>
<p>The <code>stall</code> signal is also used by rising edge sensitive module (alongside <code>instruction_valid</code>) to avoid writing data that is not valid yet because we'd have to wait for it to arrive.</p>
<h3 id="control">Control</h3>
<p>The control modules acts as an instruction decoder and determines different control signals all over the data path (e.g. the <code>pc_source</code>).</p>
<p>The control Unit also has the possibility to raise <a href="/data.md/#mcause-values-and-mtval-contents">exceptions and to set a cause</a>.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p>An instruction can be invalid (Instruction memory corrupted) or an <code>ecall</code> was fetched...</p>
</div>
<p>This <code>exception</code> flag, along with its cause are sent to the <a href="#csr-file">csr file</a> to determine what to do.</p>
<h3 id="csr-file">CSR File</h3>
<p>The CSR file contains the CSRs.</p>
<p>But it also is the heart of all operations that goes beyond the simple RV32I instruction set <strong>like traps and debugging</strong>.</p>
<p>It globally acts as the regular regfile in a way that it has register that we can read and write (addressable over 12 bits !) BUT it also outputs control signals to affect how the core behaves. For example : the CSR file has a control signal to flush the data cache, to mirror <code>mtvec</code>, <code>mepc</code> and <code>dpc</code> as a pc sources, or to set the cacheable ranges for I$ and D$.</p>
<pre><code>It also has a `trap` signal that can [cause the core to trap when conditions are met](#trap-execution-flow).
</code></pre>
<p>Using these signals, the CSR file is what controls (alongside the <a href="#control"><code>control</code> module</a>) the execution flow.</p>
<h4 id="trap-execution-flow">Trap Execution Flow</h4>
<p>Trapping occurs when :</p>
<ul>
<li>An exception occurs (flagged by the <a href="#control">control unit</a>)</li>
<li>OR an interrupt request is received (mirrored in the csr file via <code>mip</code>) and the right trap flags are enable in <code>mie</code> and <code>mstatus</code>.</li>
<li>AND the instruction fetched is flagged as valid.</li>
<li>AND we are not currently trapping (tracked by the <code>trap_taken</code> register).</li>
<li>AND a debug request is not being processed / We are not currently in debug mode</li>
</ul>
<div class="highlight"><pre><span></span><code>trap = (( (|(mie &amp; mip)) &amp;&amp; mstatus[3]) || exception) &amp;&amp; ~trap_taken &amp;&amp; ~debug_mode &amp;&amp; ~jump_to_debug;
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>So yeah, debug request have priority over traps here.</p>
</div>
<p>If these conditions are met, the CSR file will assert its <code>trap</code> flag, set all the machine <a href="/data.md/#mcause-values-and-mtval-contents">CSRs to the right value</a> (in a riscv compliant way) and the <a href="#control">control unit</a> will use this <code>trap</code> flag to set <code>mtvec</code> as the <code>next_pc</code> source (where the trap handler code is).</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p><code>mtvec</code> is set by the user in assembly, not our problem but that means having a trap handler, even when not needed, is important to avoid provoking a jump to 0x0 when an exception rises.</p>
</div>
<blockquote>
<p>Note that the <code>trap</code> flag is only high for 1 cycle, the control unit latches on that <code>trap</code> flag if needed (e.g. in case of a <code>stall</code> that lasts multiple cycles) so no worries but a better way would be to have some handshake there.. That's a todo but it works this way so I kinda don't care.</p>
</blockquote>
<p>After that, the csr file will be in <code>trap_taken</code> mode and that will clear when <code>mret</code> is signaled by the control unit, in which case <code>pc_next</code> will also be set to <code>mepc</code> to resume normal program execution after that, the trap will be able to trap again.</p>
<h4 id="debug-execution-flow">Debug Execution Flow</h4>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Learn more about the debugging flow in the <a href="https://riscv.org/wp-content/uploads/2024/12/riscv-debug-release.pdf"><em>External Debug Support</em> specs</a>, especially the "A.2 Execution Based" chapter.</p>
</div>
<p>Debug works like traps.</p>
<p>We can find similar elements:</p>
<ul>
<li>A <code>jump_to_debug</code> flag, sent to the control unit when the conditions are met.</li>
<li>Some debug CSRs that are updated in a standard way when entering the debug mode</li>
<li>etc ...</li>
</ul>
<p>But there are a couple of specificities in the hardware implementation :</p>
<ul>
<li>Debug requests have a priority over all traps</li>
<li><code>ebreak</code> can jump to debug (instead of trap handler), considered as a software breakpoint depending on <code>dcsr[15:12]</code> values</li>
<li>Exceptions in debug mode do not trap but jump to the debug module's exception handler.</li>
</ul>
<h3 id="register-file">Register File</h3>
<p>The register file is a standard async read, sync write register file addressable via 5bits and containing 32 registers.</p>
<p>The <code>x0</code> register is tied to GND and cannot have any other value than 0.</p>
<h3 id="sign-extender-imm-decoder">Sign Extender / Imm Decoder</h3>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Immediate decoder is also called "sign extender" because of legacy naming.</p>
</div>
<p>The immediate decoder's role is to extract the immediate out of the instruction being fetched.</p>
<p>The way the immediate is extracted depends on the control signal sent by the main instruction decoder (<a href="#control">the control unit</a>).</p>
<h3 id="second-adder">Second Adder</h3>
<p>Below the main ALU is a second 32bits adder named "<strong>second adder</strong>" in the code base.</p>
<p>The second adder's role is to compute branch and jump targets and every other pc-related values (e.g. values needed for <code>auipc</code>).</p>
<p>The second adder's result can also be used to access directly the immediate's result. This is not very intuitive though and I could just have the immediate value wired to the write back MUX. I was not really clever on this one back then and that's a todo.</p>
<p>In theory, this second adder should only be used to compute pc related values and be embedded in a branching unit that would separate the branch logic from the main decoder, which makes more sense when pipelining even though not mandatory.</p>
<p>Again, that is a refactorization todo but this whole second adder thing works so I figured I would do that later. Chances are I'll never do it haha.</p>
<h3 id="alu">ALU</h3>
<p>The ALU is a standard one cycle ALU. It does not have any busy flags and <strong>executes all operations in 1 cycle.</strong></p>
<p>This is not the best for performance, but adding some busy flags + a handshake would complexify the "execution part" and I thought it was not really the priority.</p>
<h3 id="loadstore-decoder">Load/Store Decoder</h3>
<p>The load/store decoder's role is to compute the <code>byte_enable</code> mask for reads and writes.</p>
<p>In case of a write that is not a full word, it also aligns the data correctly before feeding it to the data memory.</p>
<h3 id="reader">Reader</h3>
<p>The reader's role is to <strong>format the read data</strong> coming from the data cache by aligning the data correctly and applying the <code>byte_enable</code> mask (if not a full word).</p>
<h3 id="write-back-mux">Write Back Mux</h3>
<p>The write back mux is not a module but is an important step as pipelined architectures give it its own stage.</p>
<p>Its role is to select the right data source to feed back in the registers and produce a valid signal to assert the data is valid.</p>
<p>The regfile then applies the read.</p>
<h2 id="dev-workflow-simulation">Dev Workflow &amp; Simulation</h2>
<h3 id="verification-software-stack">Verification Software Stack</h3>
<p>For the whole HOLY CORE course, we use <strong>cocotb + verilator</strong> for simulation and assertions.</p>
<p>You have a document to setup your work environment <a href="https://github.com/0BAB1/HOLY_CORE_COURSE/blob/master/setup.md">in the repo : "<strong>setup.md</strong>"</a>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Make sure you're all setup correctly to verify the things you make, this is mandatory.</p>
</div>
<h3 id="generic-rtl-changes-testing-workflow">Generic RTL Changes &amp; Testing Workflow</h3>
<h4 id="navigating-and-using-the-tb-folder-for-submodules">Navigating and Using the tb/ Folder for submodules</h4>
<p>When making improvements to the codebase, it is mandatory to verify the submodule you just modified.</p>
<p>You can learn more about how a basic cocotb testbench is structured and how it works in <a href="https://0bab1.github.io/BRH/posts/TIPS_FOR_COCOTB/">this blog post</a> or on the <a href="https://docs.cocotb.org/en/stable/quickstart.html">cocotb website</a>. In a nutshell, you use a python file as a frontend that cocotb will use to run assertion by simulating the design in the backend using whatever simulator you want, in our case, <strong>Verilator</strong>.</p>
<p>To verify, <code>cd</code> into <code>&lt;edition_root&gt;/tb/&lt;module_name&gt;</code> and run <code>make</code>.</p>
<p>If you added significant changes, make sure you add the adequate test cases to the cocotb python file.</p>
<p>Once your changes are verified, cd back into <code>tb/</code> and run <code>pytest test_runner.py</code>, this will run all tests on all submodules.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Running the cocotb testbench for <code>tb/holy_core</code> is slightly different, more infos <a href="#verifying-the-holy-core-using-the-cocotb-testbench">below</a>.</p>
</div>
<div class="admonition bug">
<p class="admonition-title">Bug</p>
<p>Sometimes, the tests fail with no real reason, cd back to the edition's root and run <code>make clean</code> to clean up all simulation builds and retry <code>pytest test_runner.py</code> in the <code>tb/</code> folder.</p>
</div>
<h4 id="verifying-the-holy-core-using-the-cocotb-testbench">Verifying the HOLY CORE using the cocotb testbench</h4>
<h5 id="testbench-structure">Testbench Structure</h5>
<p>When changing some elements in the code, it is important to have a quick way to verify if our changes broke something. Verifying the core is especially long with methods like the RISCOF framework.</p>
<p>This is why a simple <strong>cocotb HOLY CORE testbench</strong> was developed.</p>
<p>Just like any other submodule, you can verify the core running a simple make command : <code>make sim</code>.</p>
<p>Note, the <code>sim</code> added after make : this is because make alone builds the <code>test.S</code> program the core is tested against.</p>
<p>Here is the <code>tb/holy_core/</code> file structure in details :</p>
<div class="highlight"><pre><span></span><code>tb/holy_core
├── axi_if_convert.sv       Top wrapper used to convert axi interfaces for cocotb to understand
├── holy_test_harness.sv    Harness wrapper embedding some peripherals. See it as a stripped down holy_top.sv
├── Makefile                Builds test.S into a .hex file and runs sim. 
├── old                     Misc
├── test_dmemory.hex        Legacy memory init file (still used)
├── test_holy_core.py       Cocotb assertions
└── test.s                  Actual test program
</code></pre></div>
<p>As you can see, there is a test harness and a top wrapper that goes around the HOLY CORE that embeds basic peripherals that the test program will use to test basic SoC interaction :</p>
<p><img alt="holy core cocotb test harness" src="../images/hc_cocotb_tb.png" /></p>
<h5 id="test-program">Test Program</h5>
<p>The <code>test.S</code> programs runs the HOLY CORE through basic instructions and the cocotb testbench runs assertions to make sure these simple test cases executed as expected.</p>
<p>When running <code>make sim</code>, it is compiled into an elf and dumped into a <code>.hex</code> file, which cocotb can read, interpret and load into its simulated memory that the core will then access as regular memory to fetch instruction and run data transactions.</p>
<p>It also runs the core through some basic trap and debug flow to check the core's behavior is correct and compliant as these are not tested by riscof and are complicated to test otherwise.</p>
<p>This basic testbench for the HOLY CORE is the best dev tool to quickly verify your changes did not break everything, once your changes are verified and this test passes, you can move on to <a href="#verifying-the-core-using-riscof">verifying using RISCOF</a>.</p>
<h4 id="verifying-the-core-using-riscof">Verifying the core using RISCOF</h4>
<p>The RISCOF verification framework is far more "heavyweight" than the basic tests we detailed in <a href="#verifying-the-holy-core-using-the-cocotb-testbench">"<em>Verifying the HOLY CORE using the cocotb testbench</em>"</a>.</p>
<p>This document will not explain how <a href="https://riscof.readthedocs.io/en/latest/intro.html">RISCOF works</a>. Nor how the plugin is built as this is too dense and detailed extensively in the tutorials.</p>
<p>The RISCOF verification happens in the <code>riscof/</code> folder :</p>
<div class="highlight"><pre><span></span><code>riscof
├── config.ini          Riscof Hints
├── holy_core           Contains the HOLY CORE riscof plugin
├── holy_core_tb        Contains a holy core cocotb testbench, adapted especially for riscof
├── Makefile            Cleanup makefile
├── readme.md           Guide on how to setup and run RISCOF tests
├── riscof_work         (Once you run the test) contains all the results
├── riscv-arch-test     (Once you run the test) contains all the RV tests source code
├── spike               Contains the reference simulator riscof plugin
└── testlist.yaml       Not used
</code></pre></div>
<p>In the backstage, RISCOF will use a cocotb testbench to test each program and dump the tests results into a signature file, which will get compared to a reference signature file (from the SPIKE Risc-V simulator).</p>
<p>To run the tests, a guide already exists in the <code>riscof/readme.md</code> file.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>RISCOF tests executions (on the HOLY CORE) are all preceded by the execution of <code>riscof/holy_core_tb/test_startup.S</code>, which ironically also contains a test end macro.</p>
<p>The goal of this very small piece of code is to <a href="/#external-interfaces-cache-usage-for-the-user-via-csrs">setup the caches</a> and set everything as non cachable, meaning all RISCOF tests run as fully cached.</p>
<p>The test end makes sure to flush the cache before fully ending the test.</p>
<p>This piece of code is entirely customizable to your need to ease debugging, make sure you build it correctly with <code>make -f start.Makefile</code></p>
</div>
<h3 id="riscof-debugging-guidelines">RISCOF Debugging Guidelines</h3>
<p>RISCOF runs tests and compares signatures, but it offers little to no debug utilities.</p>
<p>Fortunately, we have excellent ways to debug the HOLY CORE if a test fails.</p>
<p>In the <code>riscof/riscof_work</code> folder lies all the tests results. Here's the <code>add</code> test sim results as an example:</p>
<div class="highlight"><pre><span></span><code>riscof/riscof_work/rv32i_m/I/src/add-01.S
├── dut
│   ├── dump.vcd                        HOLY CORE waveforms
│   ├── DUT-holy_core.signature         Signature file (should be same as Reference-spike.signature)
│   ├── dut.log                         Spike-like CPU logs
│   ├── dut.symbols                     Test elf&#39;s symbols
│   ├── my.bin                          Test bin
│   ├── my.elf                          Test elf
│   ├── my.hex                          Test hex
│   └── tb_messages.log                 Cocotb logs
└── ref
    ├── my.elf                          Test elf
    ├── Reference-spike.signature       Spike ref signature
    └── ref.log                         Spike CPU logs
</code></pre></div>
<p>If you know the test fails from the report, you can use these results to investigate.</p>
<p>First of all, use <code>tb_messages.log</code> to check if the cocotb test went well, if it failed, investigate on this error first (<em>syntax ? forgot to cleanup ? error loading the program ? etc</em>).</p>
<p>Then, a great tool to know <strong>exactly when the HOLY CORE FAILED to follow a "compliant execution flow"</strong> is to use <code>dut.log</code> and <code>ref.log</code>.</p>
<p>These logging files trace back all register, csr, memory and pc transaction / evolutions, which allows the dev (you) to <strong>pinpoint exactly when the CPU failed to execute the program in a compliant way</strong> and therefore fail the test.</p>
<p>Once the exact failure point in the simulation has been identified, you can use the waveform and your knowledge of the RISC-V specs to patch the HDL accordingly.</p>
<h3 id="simulating-real-program-execution">Simulating Real Program Execution</h3>
<p>Sometimes, RISCOF tests pass but bugs (unexpected exceptions) occur when testing a piece of software on FPGA.</p>
<p>It may not always be due to hardware bugs, but it may be and sometimes, all the software debugging tools are not enough to clear that doubt.</p>
<p>A good solution to clear that doubt (or shed light on a specific edge case bug) is to simulate the actual software execution.</p>
<p>To do so, in <code>fpga/</code>, you have access to another cocotb testbench : <code>test_run_lint.py</code>. (<em>named "lint" as it was first built to lint <code>holy_top.sv</code></em>).</p>
<p>This testbench simulates the holy_top.sv internal base SoC directly and the whole externals are just cocotb simulated RAM slaves :</p>
<p><img alt="fpga testbench scheme" src="../images/fpga_tb.png" /></p>
<p>What this testbench do is load whatever <code>.hex</code> dump file you specify in the simulated memory and release reset.</p>
<h4 id="prepare-your-program">Prepare your Program</h4>
<p>To simulate your program, you first need to get it into a hex dump format. <a href="/#write-build">The <code>example_program</code> folder</a> allows you to build software and automatically generate the said hexdump in the right format.</p>
<p>Once this is done, you can specify the following in <code>test_run_lint.py</code> :</p>
<div class="highlight"><pre><span></span><code>hex_path = &quot;path_to_your_hex.hex&quot;
</code></pre></div>
<h4 id="prepare-the-holy_topsv-soc">Prepare the <code>holy_top.sv</code> SoC</h4>
<p>The real <code>holy_top.sv</code> gets simulated with your program in memory here.</p>
<p>BUT :</p>
<ul>
<li>The program gets loaded at address 0x80000000</li>
<li>The CPU start (boots) at PC = 0x00000000</li>
<li>The code at 0x00000000 is the one in the BOOT ROM</li>
</ul>
<p>And remember, by default, the ROM implement an FPGA park loop to wait for the User to connect with a debugger.</p>
<p>That means you should <a href="/#default-boot-sequence"><strong>modify</strong> the boot rom</a> to jump to 0x80000000 with a program that looks like this:</p>
<div class="highlight"><pre><span></span><code>    .global _start

_start:
    # ==============================================
    # for TestBench : Jump to Main program directly
    # ==============================================

    # Example of sim start sequence : setup cache if needed
    # data cache setup
    li t0, 0x0
    li t0, 0x7FFFFFFF
    csrrw x0, 0x7C1, t0
    csrrw x0, 0x7C2, t1

    # instr cache setup
    li t0, 0x0
    li t1, 0x7FFFFFFF
    csrrw x0, 0x7C3, t0
    csrrw x0, 0x7C4, t1

    // jump to program in cocotb&#39;s ram
    la t0, 0x80000000
    jalr x0, t0, 0   
</code></pre></div>
<p>And your program should start executing.</p>
<p>You can of course modify <code>test_run_lint.py</code> to fit your needs and stop the test whenever a condition is met (e.g. an exception has been met or a predefined PC has been reached...)</p>
<p>You can use this useful simulation tool to :</p>
<ul>
<li>Profile a program's performance (e.g. IPC/CPI)</li>
<li>Reproduce software bugs in simulation</li>
<li>test SoC components behavior (CLINT, PLIC, ...)</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Make sure you restore <code>rom.s</code> and rebuild it like it was before to avoid unexpected bugs for future FPGA users.</p>
</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": [], "search": "../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>